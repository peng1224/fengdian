{"version":3,"file":"login.js","sources":["pages/login/login.vue","../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<template>\n  <view class=\"login-page\">\n    <view class=\"page-header\">\n      <navigator class=\"back-btn\" open-type=\"switchTab\" url=\"/pages/profile/profile\">\n        <uni-icons type=\"left\" size=\"22\" color=\"#1c1c1e\"></uni-icons>\n      </navigator>\n      <view class=\"header-title\">登录 / 注册</view>\n    </view>\n\n    <view class=\"content-area\">\n      <view class=\"form-card\">\n        <form @submit.prevent=\"handleLogin\">\n          <view class=\"input-row\">\n            <uni-icons type=\"phone-filled\" size=\"22\" color=\"#8a8a8e\"></uni-icons>\n            <input class=\"input-field\" v-model=\"loginForm.phone\" type=\"number\" placeholder=\"请输入手机号\" @input=\"onPhoneInput\" maxlength=\"11\" />\n          </view>\n          <view class=\"input-row\">\n            <uni-icons type=\"locked-filled\" size=\"22\" color=\"#8a8a8e\"></uni-icons>\n            <input class=\"input-field\" v-model=\"loginForm.code\" type=\"number\" placeholder=\"请输入验证码\" maxlength=\"4\" @input=\"onCodeInput\" />\n            <button class=\"code-btn\" @click.prevent=\"sendSmsCode\" :disabled=\"sendingCode || !isPhoneValid\">\n              {{ sendingCode ? `${countdown}s` : '获取验证码' }}\n            </button>\n          </view>\n          <button class=\"confirm-btn\" form-type=\"submit\" :loading=\"isLoading\">登录 / 注册</button>\n        </form>\n      </view>\n\n      <view class=\"terms-agreement\">\n        <text>登录/注册即表示您已阅读并同意</text>\n        <navigator url=\"/pages/terms/terms\" class=\"link-text\">《服务条款与隐私政策》</navigator>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, reactive, computed } from 'vue';\n\nconst isLoading = ref(false); // 登录加载状态\nconst sendingCode = ref(false); // 验证码发送状态\nconst countdown = ref(0); // 验证码倒计时\nlet timerInterval = null; // 倒计时定时器\n\n// 表单数据\nconst loginForm = reactive({\n  phone: '',\n  code: ''\n});\n\n// 手机号有效性校验\nconst isPhoneValid = computed(() => /^1\\d{10}$/.test(loginForm.phone));\n\n// 输入清理：手机号\nfunction onPhoneInput(e) {\n  loginForm.phone = e.detail.value.replace(/\\D/g, '');\n}\n\n// 输入清理：验证码\nfunction onCodeInput(e) {\n  loginForm.code = e.detail.value.replace(/\\D/g, '');\n}\n\n// 发送验证码\nasync function sendSmsCode() {\n  if (!isPhoneValid.value) {\n    uni.showToast({ title: '请输入有效手机号', icon: 'none' });\n    return;\n  }\n\n  sendingCode.value = true;\n  countdown.value = 60;\n  timerInterval = setInterval(() => {\n    countdown.value--;\n    if (countdown.value <= 0) {\n      clearInterval(timerInterval);\n      sendingCode.value = false;\n    }\n  }, 1000);\n\n  try {\n    const { result } = await uniCloud.callFunction({\n      name: 'sendSmsCode',\n      data: { phone: loginForm.phone }\n    });\n\n    if (result.success) {\n      uni.showToast({ title: '验证码已发送', icon: 'none' });\n      // 开发阶段可输出验证码到控制台\n      if (result.code) {\n        console.log('[开发调试] 验证码:', result.code);\n      }\n    } else {\n      throw new Error(result.errorMsg || '验证码发送失败');\n    }\n  } catch (err) {\n    clearInterval(timerInterval);\n    sendingCode.value = false;\n    uni.showToast({ title: err.message || '验证码发送异常', icon: 'none' });\n  }\n}\n\n// 跳转逻辑\nfunction redirectToHomePage(userType) {\n  let targetPath = '/pages/profile/profile';\n  if (userType === 'admin') {\n    targetPath = '/pages/profile/profile';\n  } else if (userType === 'worker') {\n    targetPath = '/pages/profile/profile';\n  } else {\n    targetPath = '/pages/profile/profile';\n  }\n\n  uni.reLaunch({\n    url: targetPath,\n    success: () => console.log(`[Login] 跳转成功: ${targetPath}`),\n    fail: (e) => console.error(`[Login] 跳转失败: ${targetPath}`, e)\n  });\n}\n\n// 登录\nasync function handleLogin() {\n  if (!isPhoneValid.value) {\n    uni.showToast({ title: '请输入有效手机号', icon: 'none' });\n    return;\n  }\n  if (!/^\\d{4}$/.test(loginForm.code)) {\n    uni.showToast({ title: '请输入4位验证码', icon: 'none' });\n    return;\n  }\n\n  uni.showLoading({ title: '登录中...' });\n  isLoading.value = true;\n\n  try {\n    const pushClientId = uni.getPushClientId();\n    const { result } = await uniCloud.callFunction({\n      name: 'loginByPhone',\n      data: { phone: loginForm.phone, code: loginForm.code, pushClientId }\n    });\n\n    console.log('[Login] 登录结果:', result);\n\n    if (result.code === 0 && result.userInfo) {\n      uni.setStorageSync('userinfo', result.userInfo);\n      uni.$emit('user-login');\n      uni.showToast({ title: '登录成功！', icon: 'none' });\n      redirectToHomePage(result.userInfo.userType);\n    } else {\n      uni.showToast({ title: result.errorMsg || '登录失败', icon: 'none' });\n    }\n  } catch (err) {\n    console.error('[Login] 登录异常:', err);\n    uni.showToast({ title: err.message || '登录异常', icon: 'none' });\n  } finally {\n    uni.hideLoading();\n    isLoading.value = false;\n  }\n}\n</script>\n\n<style lang=\"scss\">\n/* 保持原有样式不变 */\n$page-bg: #f4f4f8;\n$primary-blue: #007aff;\n$text-primary: #1c1c1e;\n$text-secondary: #8a8a8e;\n$text-placeholder: #c7c7cc;\n$card-bg: #ffffff;\n$border-color: #e5e5ea;\n\n.login-page {\n  background-color: $page-bg;\n  min-height: 100vh;\n  width: 100%;\n}\n\n.page-header {\n  padding: 100rpx 30rpx 20rpx;\n  display: flex;\n  align-items: center;\n  position: relative;\n  justify-content: center;\n\n  .back-btn {\n    position: absolute;\n    left: 30rpx;\n    top: 50%;\n    transform: translateY(25%);\n  }\n\n  .header-title {\n    font-size: 34rpx;\n    font-weight: 600;\n    color: $text-primary;\n  }\n}\n\n.content-area {\n  padding: 80rpx 40rpx;\n}\n\n.login-toggle {\n  display: flex;\n  background-color: #e9e9eb;\n  border-radius: 16rpx;\n  padding: 6rpx;\n  margin-bottom: 50rpx;\n\n  .toggle-option {\n    flex: 1;\n    padding: 18rpx 0;\n    text-align: center;\n    font-size: 30rpx;\n    font-weight: 500;\n    color: $text-secondary;\n    border-radius: 12rpx;\n    transition: all 0.3s ease;\n\n    &.active {\n      background-color: $card-bg;\n      color: $primary-blue;\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n    }\n  }\n}\n\n.form-card {\n  background-color: $card-bg;\n  border-radius: 24rpx;\n  padding: 20rpx 40rpx 50rpx;\n  box-shadow: 0 8rpx 32rpx rgba(0, 0, 0, 0.05);\n}\n\n.input-row {\n  display: flex;\n  align-items: center;\n  padding: 20rpx 0;\n  border-bottom: 1px solid $border-color;\n  transition: border-color 0.3s ease;\n\n  &:focus-within {\n    border-bottom-color: $primary-blue;\n  }\n\n  .uni-icons {\n    margin-right: 20rpx;\n  }\n}\n\n.input-field {\n  flex: 1;\n  font-size: 32rpx;\n  color: $text-primary;\n  height: 60rpx;\n  line-height: 60rpx;\n  background: none;\n  border: none;\n  outline: none;\n\n  &::placeholder {\n    color: $text-placeholder;\n  }\n}\n\n.code-btn {\n  font-size: 28rpx;\n  font-weight: 500;\n  color: $primary-blue;\n  padding: 0 10rpx;\n  margin: 0;\n  background: none;\n  border-radius: 10rpx;\n\n  &::after {\n    border: none;\n  }\n\n  &[disabled] {\n    color: $text-secondary;\n    background: none;\n  }\n}\n\n.confirm-btn {\n  width: 100%;\n  height: 96rpx;\n  line-height: 96rpx;\n  margin-top: 60rpx;\n  background-color: $primary-blue;\n  color: #fff;\n  font-size: 34rpx;\n  font-weight: 500;\n  border-radius: 48rpx;\n  border: none;\n\n  &::after {\n    border: none;\n  }\n}\n\n.terms-agreement {\n  text-align: center;\n  margin-top: 60rpx;\n  font-size: 26rpx;\n  color: $text-secondary;\n\n  .link-text {\n    display: inline;\n    color: $primary-blue;\n    text-decoration: none;\n  }\n}\n</style>","import MiniProgramPage from 'D:/peng.folder/fengdian-main/fengdian-main/pages/login/login.vue'\ntt.createPage(MiniProgramPage)"],"names":["ref","reactive","computed","uni","uniCloud","MiniProgramPage"],"mappings":"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"}