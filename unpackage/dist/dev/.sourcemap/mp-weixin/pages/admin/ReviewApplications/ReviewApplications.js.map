{"version":3,"file":"ReviewApplications.js","sources":["pages/admin/ReviewApplications/ReviewApplications.vue","../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYWRtaW4vUmV2aWV3QXBwbGljYXRpb25zL1Jldmlld0FwcGxpY2F0aW9ucy52dWU"],"sourcesContent":["<template>\n  <view class=\"page\">\n    <view class=\"title\">待审核技工申请</view>\n    <scroll-view class=\"list\" scroll-y>\n      <view v-for=\"item in list\" :key=\"item._id\" class=\"card\">\n        <view class=\"label\">姓名：{{ item.technicianInfo.realName }}</view>\n        <view class=\"label\">身份证号：{{ item.technicianInfo.idCard }}</view>\n        <view class=\"label\">技能：{{ item.technicianInfo.skills }}</view>\n        <view class=\"certs\">\n          <image\n            v-for=\"(c, i) in item.technicianInfo.certificates\"\n            :key=\"i\"\n            :src=\"c\"\n            class=\"cert-img\"\n            mode=\"aspectFill\"/>\n        </view>\n        <view class=\"actions\">\n          <button @click=\"review(item._id, 'approve')\" type=\"primary\">通过</button>\n          <button @click=\"review(item._id, 'reject')\" type=\"warn\">拒绝</button>\n        </view>\n      </view>\n    </scroll-view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue';\n\nconst list = ref([]);\n\n// 使用云函数拉取待审核列表\nasync function loadPending() {\n  const { result } = await uniCloud.callFunction({\n    name: 'getPendingApplications'\n  });\n  if (result.success) {\n    list.value = result.data;\n  } else {\n    uni.showToast({ title: result.msg || '加载失败', icon: 'none' });\n  }\n}\n\n// 审核函数保持不变\nasync function review(uid, action) {\n  let reason = '';\n  if (action === 'reject') {\n    const { confirm, content } = await new Promise(resolve => {\n      uni.showModal({\n        title: '拒绝原因',\n        placeholderText: '请输入原因',\n        editable: true,\n        success: resolve\n      });\n    });\n    if (!confirm) return;\n    reason = content;\n  }\n  uni.showLoading({ title: '提交审核...' });\n    try {\n      const res = await uniCloud.callFunction({\n        name: 'reviewTechnicianApplication',\n        data: { uid, action, reason }\n      });\n      console.log('reviewTechnicianApplication 返回：', res);\n      uni.hideLoading();\n      if (res.result && res.result.success) {\n        uni.showToast({ title: '操作成功', icon: 'success' });\n        await loadPending();\n      } else {\n        uni.showToast({ title: (res.result && res.result.msg) || '操作失败', icon: 'none' });\n      }\n    } catch (err) {\n      uni.hideLoading();\n      console.error('调用 reviewTechnicianApplication 错误：', err);\n      uni.showToast({ title: '网络或服务异常', icon: 'none' });\n    }\n    }\n\nonMounted(() => {\n  const user = uni.getStorageSync('userinfo') || {};\n  if (user.userType !== 'admin') {\n    uni.showToast({ title: '无权限访问', icon: 'none' });\n    uni.reLaunch({ url: '/pages/profile/profile' });\n  } else {\n    loadPending();\n  }\n});\n</script>\n\n<style scoped>\n.page { padding: 20rpx; background: #f5f5f5; }\n.title { font-size: 36rpx; margin-bottom: 20rpx; }\n.list { max-height: 100%; }\n.card {\n  background: #fff; padding: 20rpx; border-radius: 12rpx; margin-bottom: 20rpx;\n}\n.label { font-size: 28rpx; color: #333; margin-bottom: 10rpx; }\n.certs { flex-direction: row; margin: 10rpx 0; }\n.cert-img { width: 100rpx; height: 100rpx; border-radius: 8rpx; margin-right: 10rpx; }\n.actions { flex-direction: row; justify-content: flex-end; gap: 20rpx; margin-top: 10rpx; }\n</style>","import MiniProgramPage from 'D:/peng.folder/fengdian-main/蜂点到家/pages/admin/ReviewApplications/ReviewApplications.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uniCloud","uni","onMounted"],"mappings":";;;;;AA4BA,UAAM,OAAOA,cAAAA,IAAI,CAAA,CAAE;AAGnB,mBAAe,cAAc;AAC3B,YAAM,EAAE,OAAM,IAAK,MAAMC,cAAAA,GAAS,aAAa;AAAA,QAC7C,MAAM;AAAA,MACV,CAAG;AACD,UAAI,OAAO,SAAS;AAClB,aAAK,QAAQ,OAAO;AAAA,MACxB,OAAS;AACLC,4BAAI,UAAU,EAAE,OAAO,OAAO,OAAO,QAAQ,MAAM,OAAM,CAAE;AAAA,MAC5D;AAAA,IACH;AAGA,mBAAe,OAAO,KAAK,QAAQ;AACjC,UAAI,SAAS;AACb,UAAI,WAAW,UAAU;AACvB,cAAM,EAAE,SAAS,QAAO,IAAK,MAAM,IAAI,QAAQ,aAAW;AACxDA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,iBAAiB;AAAA,YACjB,UAAU;AAAA,YACV,SAAS;AAAA,UACjB,CAAO;AAAA,QACP,CAAK;AACD,YAAI,CAAC;AAAS;AACd,iBAAS;AAAA,MACV;AACDA,oBAAAA,MAAI,YAAY,EAAE,OAAO,UAAW,CAAA;AAClC,UAAI;AACF,cAAM,MAAM,MAAMD,cAAQ,GAAC,aAAa;AAAA,UACtC,MAAM;AAAA,UACN,MAAM,EAAE,KAAK,QAAQ,OAAQ;AAAA,QACrC,CAAO;AACDC,sBAAY,MAAA,MAAA,OAAA,+DAAA,mCAAmC,GAAG;AAClDA,sBAAG,MAAC,YAAW;AACf,YAAI,IAAI,UAAU,IAAI,OAAO,SAAS;AACpCA,wBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,UAAS,CAAE;AAChD,gBAAM,YAAW;AAAA,QACzB,OAAa;AACLA,wBAAAA,MAAI,UAAU,EAAE,OAAQ,IAAI,UAAU,IAAI,OAAO,OAAQ,QAAQ,MAAM,OAAQ,CAAA;AAAA,QAChF;AAAA,MACF,SAAQ,KAAK;AACZA,sBAAG,MAAC,YAAW;AACfA,sBAAc,MAAA,MAAA,SAAA,+DAAA,sCAAsC,GAAG;AACvDA,sBAAG,MAAC,UAAU,EAAE,OAAO,WAAW,MAAM,OAAM,CAAE;AAAA,MACjD;AAAA,IACA;AAELC,kBAAAA,UAAU,MAAM;AACd,YAAM,OAAOD,cAAG,MAAC,eAAe,UAAU,KAAK,CAAA;AAC/C,UAAI,KAAK,aAAa,SAAS;AAC7BA,sBAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,OAAM,CAAE;AAC9CA,sBAAAA,MAAI,SAAS,EAAE,KAAK,yBAA0B,CAAA;AAAA,MAClD,OAAS;AACL;MACD;AAAA,IACH,CAAC;;;;;;;;;;;;;;;;;;;;;;;;ACrFD,GAAG,WAAW,eAAe;"}