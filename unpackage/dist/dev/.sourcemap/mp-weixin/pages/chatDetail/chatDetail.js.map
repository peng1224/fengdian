{"version":3,"file":"chatDetail.js","sources":["pages/chatDetail/chatDetail.vue","../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2hhdERldGFpbC9jaGF0RGV0YWlsLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"chat-container\">\n    <!--\n      【关键修改 #1】\n      - 移除 :scroll-top=\"scrollTop\"\n      - 新增 :scroll-into-view=\"scrollIntoView\"\n      - scroll-into-view 会将视图滚动到指定 id 的子元素位置，比设置 scrollTop 更可靠。\n    -->\n    <scroll-view\n      class=\"message-scroll-view\"\n      scroll-y\n      :style=\"{ height: scrollViewHeight + 'px' }\"\n      :scroll-into-view=\"scrollIntoView\"\n      scroll-with-animation\n      @scrolltoupper=\"loadMoreMessages\"\n    >\n      <view class=\"loading-more\" v-if=\"isLoadingMore\">正在加载更多...</view>\n\n      <!-- 每条消息都拥有一个唯一的 id，用于 scroll-into-view 定位 -->\n      <view\n        v-for=\"msg in messages\"\n        :key=\"msg._id\"\n        :id=\"'msg-' + msg._id\"\n      >\n        <view\n          class=\"message-item\"\n          :class=\"[msg.sender === myPhoneNumber ? 'mine' : 'other', { 'system-message': msg.isSystemMessage }, msg.messageType ? msg.messageType : '']\"\n        >\n          <image\n            v-if=\"msg.isSystemMessage\"\n            class=\"system-icon\"\n            src=\"/static/images/appointment-time.png\"\n            mode=\"aspectFill\"\n          />\n          <image\n            v-else\n            class=\"avatar\"\n            :src=\"msg.avatarUrl\"\n            mode=\"aspectFill\"\n            @error=\"handleAvatarError(msg)\"\n          />\n          <view class=\"msg-content\">\n            <view\n              class=\"bubble\"\n              :class=\"{ revoked: msg.isRevoked }\"\n              @longpress=\"onMessageLongPress(msg)\"\n            >\n              <text v-if=\"msg.type === 'text' && !msg.isRevoked\">{{ msg.message }}</text>\n              <image\n                class=\"msg-image\"\n                v-if=\"msg.type === 'image' && !msg.isRevoked\"\n                :src=\"msg.fileUrl\"\n                mode=\"aspectFit\"\n                @click=\"previewImage(msg.fileUrl)\"\n              />\n              <view\r\n                v-if=\"msg.type === 'location' && !msg.isRevoked\"\r\n                class=\"location-msg\"\r\n                @click=\"previewLocation(msg.location)\"\r\n              >\r\n                <image\r\n                  class=\"map-thumb\"\r\n                  :src=\"getMapThumbUrl(msg.location)\"\r\n                  mode=\"aspectFill\"\r\n                  @error=\"handleMapThumbError\"\r\n                />\n                <view class=\"map-info\">\n                  <text class=\"map-title\">{{ msg.location.name || '位置' }}</text>\n                  <text class=\"map-address\">{{ msg.location.address }}</text>\n                </view>\n              </view>\n              <text\n                class=\"revoked-text\"\n                v-if=\"msg.isRevoked\"\n              >{{ msg.sender === myPhoneNumber ? '你' : '对方' }}撤回了一条消息</text>\n              <view class=\"time\">{{ formatTimestamp(msg.timestamp) }}</view>\n            </view>\n          </view>\n        </view>\n      </view>\n    </scroll-view>\n\n    <view class=\"input-bar\" :style=\"{ bottom: keyboardHeight + 'px' }\">\n      <image\n        src=\"/static/images/sendImg.png\"\n        class=\"icon-btn\"\n        @click=\"sendImage\"\n      />\n      <image\n        src=\"/static/images/location.png\"\n        class=\"icon-btn\"\n        @click=\"sendLocation\"\n      />\n      <input\n        class=\"input\"\n        v-model=\"messageInput\"\n        placeholder=\"请输入消息...\"\n        confirm-type=\"send\"\n        @confirm=\"sendTextMessage\"\n        :adjust-position=\"false\"\n        cursor-spacing=\"20\"\n      />\n      <button class=\"send-btn\" @click=\"sendTextMessage\">发送</button>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, nextTick, onUnmounted } from 'vue';\nimport { getCurrentInstance } from 'vue';\nimport { onLoad, onReady, onShow, onHide } from '@dcloudio/uni-app';\n\n// --- 常量与配置 ---\nconst QQ_MAP_KEY_MP    = 'ZOYBZ-S7V6G-OSQQ2-QA54H-2PBHE-CXF46';\nconst QQ_MAP_KEY_APP   = '3QUBZ-FFCCB-6GYUO-NQI2R-WDUB5-BJFIY';\nconst DEFAULT_AVATAR   = '/static/images/avatar-placeholder.png';\nconst PAGE_SIZE        = 15;\n\n// --- 响应式状态 ---\nconst sessionId        = ref('');\nconst myPhoneNumber    = ref('');\nconst messages         = ref([]);\nconst messageInput     = ref('');\n// 【关键修改 #2】用 scrollIntoView 替代 scrollTop\nconst scrollIntoView   = ref('');\nconst scrollViewHeight = ref(0);\nconst keyboardHeight   = ref(0);\nconst isLoadingMore    = ref(false);\nconst noMoreMessages   = ref(false);\n\n// --- 轮询相关 ---\nlet pollingTimer = null;\nconst lastMessageTimestamp = ref(0);\n\n// --- 方法 ---\nconst formatTimestamp = ts => {\n    if (!ts) return '未知时间';\n    const d = new Date(ts);\n    if (isNaN(d.getTime())) return '无效时间';\n    const mm = String(d.getMonth() + 1).padStart(2, '0');\n    const dd = String(d.getDate()).padStart(2, '0');\n    const HH = String(d.getHours()).padStart(2, '0');\n    const MM = String(d.getMinutes()).padStart(2, '0');\n    return `${d.getFullYear()}/${mm}/${dd} ${HH}:${MM}`;\n};\n\nconst calcScrollHeight = () => {\n    const inst = getCurrentInstance();\n    if (!inst) return;\n    uni.createSelectorQuery().in(inst)\n        .select('.input-bar')\n        .boundingClientRect(rect => {\n            if (!rect) return;\n            const winH = uni.getSystemInfoSync().windowHeight;\n            scrollViewHeight.value = winH - rect.height - keyboardHeight.value;\n            // 高度变化后也尝试滚动到底部\n            scrollToBottom();\n        })\n        .exec();\n};\n\n/**\n * @description 【关键修改 #3】重写滚动到底部的方法\n * - 不再设置 scrollTop，而是更新 scrollIntoView 的值为最后一条消息的 ID。\n * - 使用 nextTick 确保在 DOM 更新（新消息渲染出来）之后再执行滚动。\n */\nconst scrollToBottom = () => {\n    nextTick(() => {\n        if (messages.value.length > 0) {\n            const lastMessage = messages.value[messages.value.length - 1];\n            scrollIntoView.value = 'msg-' + lastMessage._id;\n        }\n    });\n};\n\nconst fetchInitialMessages = async () => {\n    try {\n        const res = await uniCloud.callFunction({\n            name: 'get-history-messages',\n            data: {\n                sessionId: sessionId.value,\n                lastTimestamp: Date.now(),\n                pageSize: PAGE_SIZE\n            }\n        });\n        if (res.result.success) {\n            const arr = await processMessages(res.result.data);\n            messages.value = arr;\n            noMoreMessages.value = arr.length < PAGE_SIZE;\n            if (arr.length > 0) {\n                lastMessageTimestamp.value = arr[arr.length - 1].timestamp;\n            } else {\n                lastMessageTimestamp.value = Date.now();\n            }\n            // 初始加载后滚动到底部\n            scrollToBottom();\n        } else {\n            uni.showToast({ title: '获取消息失败', icon: 'none' });\n        }\n    } catch (e) {\n        console.error('获取初始消息失败:', e);\n    }\n};\n\nconst loadMoreMessages = async () => {\n    if (isLoadingMore.value || noMoreMessages.value) return;\n    isLoadingMore.value = true;\n    try {\n        const firstTs = messages.value[0]?.timestamp || Date.now();\n        const res = await uniCloud.callFunction({\n            name: 'get-history-messages',\n            data: {\n                sessionId: sessionId.value,\n                lastTimestamp: firstTs,\n                pageSize: PAGE_SIZE\n            }\n        });\n        if (res.result.success && res.result.data.length > 0) {\n            const arr = await processMessages(res.result.data);\n            const oldFirstMsgId = 'msg-' + messages.value[0]?._id; // 记录旧的第一条消息ID\n            messages.value = [...arr, ...messages.value];\n            noMoreMessages.value = res.result.data.length < PAGE_SIZE;\n            // 加载更多后，滚动回之前的第一条消息位置，防止跳动\n            nextTick(() => {\n                scrollIntoView.value = oldFirstMsgId;\n            });\n        } else {\n            noMoreMessages.value = true;\n        }\n    } catch (e) {\n        console.error('加载更多消息失败:', e);\n    } finally {\n        isLoadingMore.value = false;\n    }\n};\n\nconst processMessages = async raw => {\n    const imgs = raw.filter(m => m.type === 'image' && m.fileUrl.startsWith('cloud://'))\n                     .map(m => m.fileUrl);\n    let urlMap = {};\n    if (imgs.length) {\n        const tmp = await uniCloud.getTempFileURL({ fileList: imgs });\n        tmp.fileList.forEach(item => {\n            urlMap[item.fileID] = item.tempFileURL;\n        });\n    }\n    return raw.map(m => ({\n        ...m,\n        avatarUrl: m.avatarUrl || DEFAULT_AVATAR,\n        fileUrl: m.type === 'image' ? (urlMap[m.fileUrl] || m.fileUrl) : m.fileUrl\n    }));\n};\n\nconst pollForNewMessages = async () => {\n    if (!sessionId.value || !lastMessageTimestamp.value) return;\n    try {\n        const res = await uniCloud.callFunction({\n            name: 'get-latest-messages',\n            data: {\n                sessionId: sessionId.value,\n                lastTimestamp: lastMessageTimestamp.value\n            }\n        });\n\n        // 【关键修改】在这里修正整个逻辑块\n        if (res.result.success && res.result.data.length > 0) {\n            const allNewMessages = res.result.data;\n\n            // 1. 过滤出真正需要渲染到界面的、来自他人的消息\n            const otherNewMessages = allNewMessages.filter(m => m.sender !== myPhoneNumber.value);\n\n            if (otherNewMessages.length > 0) {\n                // 为了防止因网络问题或逻辑意外导致重复渲染，可以增加一道保险\n                const uniqueNewMessages = otherNewMessages.filter(\n                    newMsg => !messages.value.some(existingMsg => existingMsg._id === newMsg._id)\n                );\n\n                if(uniqueNewMessages.length > 0) {\n                    const processedMessages = await processMessages(uniqueNewMessages);\n                    messages.value.push(...processedMessages);\n                    scrollToBottom();\n                    markMessagesAsRead();\n                }\n            }\n\n            // 2. 无论如何，都用服务器返回的这批消息中最新的时间戳，来更新我们的轮询基准\n            // 这能确保我们下一次轮询的起点是服务器已知的最新位置，不会再丢失消息\n            lastMessageTimestamp.value = allNewMessages[allNewMessages.length - 1].timestamp;\n        }\n    } catch (error) {\n        console.error('轮询出错:', error);\n    }\n};\n\nconst _sendMessage = async (content) => {\n    const ui = uni.getStorageSync('userinfo') || {};\n    const localMessage = {\n        _id: `local_${Date.now()}`,\n        type: content.type,\n        sender: myPhoneNumber.value,\n        avatarUrl: ui.avatar || DEFAULT_AVATAR,\n        name: ui.name || '用户',\n        sessionId: sessionId.value,\n        timestamp: Date.now(),\n        isRevoked: false,\n        ...(content.type === 'text' ? { message: content.text } : {}),\n        ...(content.type === 'image' ? { fileUrl: content.tempPath, _tempPath: true } : {}),\n        ...(content.type === 'location' ? { location: content.location } : {})\n    };\n\n    messages.value.push(localMessage);\n    // 【关键修改 #4】在消息推入数组后，立即调用新的滚动方法\n    scrollToBottom();\n    // lastMessageTimestamp.value = localMessage.timestamp;\n\n    if (content.type === 'image') {\n        try {\n            uni.showLoading({ title: '上传中...' });\n            const uploadResult = await uniCloud.uploadFile({\n                filePath: content.tempPath,\n                cloudPath: `chat-images/${sessionId.value}/${Date.now()}`\n            });\n            content.fileID = uploadResult.fileID;\n            uni.hideLoading();\n        } catch (e) {\n            uni.hideLoading();\n            uni.showToast({ title: '图片上传失败', icon: 'none' });\n            const index = messages.value.findIndex(m => m._id === localMessage._id);\n            if (index > -1) messages.value.splice(index, 1);\n            return;\n        }\n    }\n\n    try {\n        const res = await uniCloud.callFunction({\n            name: 'send-chat-message',\n            data: {\n                sessionId: sessionId.value,\n                message: {\n                    type: content.type,\n                    sender: myPhoneNumber.value,\n                    avatarUrl: ui.avatar || DEFAULT_AVATAR,\n                    name: ui.name || '用户',\n                    ...(content.type === 'text' ? { message: content.text } : {}),\n                    ...(content.type === 'image' ? { fileUrl: content.fileID } : {}),\n                    ...(content.type === 'location' ? { location: content.location } : {})\n                }\n            }\n        });\n        if (res.result.success) {\n            const index = messages.value.findIndex(m => m._id === localMessage._id);\n            if (index > -1) {\n                messages.value[index]._id = res.result.messageId;\n                if (messages.value[index]._tempPath) delete messages.value[index]._tempPath;\n            }\n        } else {\n            uni.showToast({ title: res.result.message || '发送失败', icon: 'none' });\n            const index = messages.value.findIndex(m => m._id === localMessage._id);\n            if (index > -1) messages.value.splice(index, 1);\n        }\n    } catch (e) {\n        console.error('发送消息出错:', e);\n        uni.showToast({ title: '发送异常', icon: 'none' });\n        const index = messages.value.findIndex(m => m._id === localMessage._id);\n        if (index > -1) messages.value.splice(index, 1);\n    }\n};\n\nconst sendTextMessage = () => {\n    if (!messageInput.value.trim()) return;\n    _sendMessage({ type: 'text', text: messageInput.value });\n    messageInput.value = '';\n};\n\nconst sendImage = async () => {\n    try {\n        const res = await uni.chooseImage({ count: 1 });\n        const tempPath = res.tempFilePaths[0];\n        _sendMessage({ type: 'image', tempPath: tempPath });\n    } catch (e) {\n        // 用户取消选择\n    }\n};\n\n// pages/chatDetail/chatDetail.vue\n\nconst sendLocation = async () => {\n  uni.showLoading({ title: '正在定位...' });\n  try {\n    let latitude, longitude;\n\n    // —— 小程序平台（微信/支付宝）走原来流程\n    // #ifdef MP-WEIXIN || MP-ALIPAY\n    {\n      const settingRes = await uni.getSetting();\n      if (!settingRes.authSetting['scope.userLocation']) {\n        await uni.authorize({ scope: 'scope.userLocation' });\n      }\n      const locRes = await uni.getLocation({ type: 'gcj02', isHighAccuracy: true });\n      latitude = locRes.latitude;\n      longitude = locRes.longitude;\n    }\n    // #endif\n\n    // —— 原生 App-Plus 环境：直接用 plus.geolocation 拿坐标\n    // #ifdef APP-PLUS\n    {\n      await new Promise((resolve, reject) => {\n        plus.geolocation.getCurrentPosition(\n          (pos) => {\n            // pos.coords 里才有真正的经纬度\n            latitude  = pos.coords.latitude;\n            longitude = pos.coords.longitude;\n            resolve();\n          },\n          (err) => {\n            reject(err);\n          },\n          { provider: 'system', geocode: false }\n        );\n      });\n    }\n    // #endif\n\n    console.log('【sendLocation】定位结果:', latitude, longitude);\n\n    // 如果依然拿不到，就提示并退出\n    if (latitude == null || longitude == null) {\n      uni.hideLoading();\n      return uni.showModal({\n        title: '定位失败',\n        content: '设备未返回定位，请检查权限或模拟器地理位置设置。',\n        showCancel: false\n      });\n    }\n\n    // —— 后续逆地理解析保持不变 —— \n    let key = '';\n    // #ifdef MP-WEIXIN\n    key = QQ_MAP_KEY_MP;\n    // #endif\n    // #ifdef APP-PLUS\n    key = QQ_MAP_KEY_APP;\n    // #endif\n\n    const { statusCode, data } = await uni.request({\n      url: 'https://apis.map.qq.com/ws/geocoder/v1/',\n      method: 'GET',\n      data: { location: `${latitude},${longitude}`, key }\n    });\n\n    if (statusCode !== 200 || data.status !== 0) {\n      throw new Error(`位置服务异常: ${data.message || '网络请求失败'}`);\n    }\n\n    const r = data.result;\n    const loc = {\n      latitude,\n      longitude,\n      name: r.formatted_addresses?.recommend\n            || r.address_component?.street_number\n            || '未知位置',\n      address: r.address || '详细地址未知',\n      thumbUrl:\n        `https://apis.map.qq.com/ws/staticmap/v2/` +\n        `?center=${latitude},${longitude}` +\n        `&zoom=16&size=800x400` +\n        `&markers=size:large|color:0x3399FF|label:D|${latitude},${longitude}` +\n        `&key=${key}`,\n    };\n    _sendMessage({ type: 'location', location: loc });\n\n  } catch (e) {\n    console.error('sendLocation 失败:', e);\n    uni.showToast({ title: e.message || '获取位置失败', icon: 'none', duration: 3000 });\n  } finally {\n    uni.hideLoading();\n  }\n};\n\n\n// 在 <script setup> 中定义\nconst getMapThumbUrl = (location) => {\n  const platform = uni.getSystemInfoSync().platform;\n  const key = platform === 'mp-weixin' ? QQ_MAP_KEY_MP : QQ_MAP_KEY_APP;\n  return `https://apis.map.qq.com/ws/staticmap/v2/?center=${location.latitude},${location.longitude}&zoom=16&size=800x400&markers=size:large|color:0x3399FF|label:D|${location.latitude},${location.longitude}&key=${key}`;\n};\n\n\n\nconst previewImage = url => {\n    const urls = messages.value.filter(m => m.type === 'image' && !m.isRevoked).map(m => m.fileUrl);\n    uni.previewImage({ current: url, urls });\n};\n\nconst previewLocation = loc => {\n    uni.openLocation({\n        latitude: loc.latitude,\n        longitude: loc.longitude,\n        name: loc.name,\n        address: loc.address,\n        scale: 18\n    });\n};\n\nconst markMessagesAsRead = async () => {\n    try {\n        await uniCloud.callFunction({\n            name: 'clear-unread-count',\n            data: { sessionId: sessionId.value, userPhoneNumber: myPhoneNumber.value }\n        });\n    } catch (e) {\n        console.error('标记已读出错:', e);\n    }\n};\n\nuni.onKeyboardHeightChange(res => {\n    keyboardHeight.value = res.height;\n    calcScrollHeight();\n});\n\nconst onMessageLongPress = async (msg) => {\n    if (msg.sender !== myPhoneNumber.value) {\n        uni.showToast({ title: '只能撤回自己的消息', icon: 'none' });\n        return;\n    }\n    const now = Date.now();\n    if (now - msg.timestamp > 2 * 60 * 1000) {\n        uni.showToast({ title: '消息发送超过2分钟，无法撤回', icon: 'none' });\n        return;\n    }\n    uni.showActionSheet({\n        itemList: ['撤回'],\n        success: async (res) => {\n            if (res.tapIndex === 0) {\n                uni.showLoading({ title: '正在撤回...' });\n                try {\n                    const result = await uniCloud.callFunction({\n                        name: 'revoke-chat-message',\n                        data: { messageId: msg._id }\n                    });\n                    if (result.result.success) {\n                        const targetMsg = messages.value.find(m => m._id === msg._id);\n                        if (targetMsg) targetMsg.isRevoked = true;\n                        uni.showToast({ title: '消息已撤回', icon: 'success' });\n                    } else {\n                        uni.showToast({ title: result.result.message || '撤回失败', icon: 'none' });\n                    }\n                } catch (e) {\n                    uni.showToast({ title: '撤回失败，请稍后重试', icon: 'none' });\n                } finally {\n                    uni.hideLoading();\n                }\n            }\n        }\n    });\n};\n\n// --- 生命周期函数 ---\nonLoad(async (options) => {\n    /**\n     * 【关键修改】\n     * - 在页面加载时，从 options 中获取 name 参数。\n     * - 使用 decodeURIComponent 解码，防止中文乱码。\n     * - 调用 uni.setNavigationBarTitle 来动态设置页面标题。\n     */\n    if (options.name) {\n        const title = decodeURIComponent(options.name);\n        uni.setNavigationBarTitle({\n            title: title\n        });\n    }\n\n    if (!options.sessionId) {\n        uni.showToast({ title: '缺少会话ID', icon: 'none', duration: 2000 });\n        setTimeout(() => uni.switchTab({ url: '/pages/index/index' }), 2000);\n        return;\n    }\n    sessionId.value = options.sessionId;\n    \n    const ui = uni.getStorageSync('userinfo');\n    if (!ui || !ui.phoneNumber) {\n        uni.showToast({ title: '请先登录', icon: 'none' });\n        return;\n    }\n    myPhoneNumber.value = ui.phoneNumber;\n    \n    await fetchInitialMessages();\n    await markMessagesAsRead();\n});\n\nonReady(() => {\n    calcScrollHeight();\n});\n\nonShow(() => {\n    if (pollingTimer) clearInterval(pollingTimer);\n    pollingTimer = setInterval(pollForNewMessages, 45000);\n    markMessagesAsRead();\n});\n\nonHide(() => {\n    if (pollingTimer) {\n        clearInterval(pollingTimer);\n        pollingTimer = null;\n    }\n});\n\nonUnmounted(() => {\n    if (pollingTimer) {\n        clearInterval(pollingTimer);\n        pollingTimer = null;\n    }\n    uni.offKeyboardHeightChange();\n});\n</script>\n\n<style lang=\"scss\">\npage {\n  height: 100%;\n}\n.chat-container {\n  position: relative;\n  height: 100vh;\n  background-color: #f5f5f5;\n  box-sizing: border-box;\n  overflow: hidden;\n}\n\n.message-scroll-view {\n  box-sizing: border-box;\n  padding-bottom: 20rpx;\n}\n\n.loading-more {\n  text-align: center;\n  color: #999;\n  font-size: 24rpx;\n  padding: 20rpx 0;\n}\n\n.message-item {\n  display: flex;\n  margin: 20rpx 30rpx 40rpx;\n  align-items: flex-start;\n\n  &.mine {\n    flex-direction: row-reverse;\n    .msg-content {\n      align-items: flex-end;\n    }\n    .bubble {\n      background: #fff;\n    }\n  }\n\n  &.system-message {\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    margin: 30rpx 30rpx 50rpx;\n\n    .avatar {\n      display: none;\n    }\n\n    .system-icon {\n      width: 80rpx;\n      height: 80rpx;\n      margin-bottom: 20rpx;\n      filter: brightness(1.2);\n    }\n\n    .bubble {\n      background: #FFF8F2;\n      color: #E65100;\n      text-align: center;\n      padding: 28rpx 40rpx;\n      border-radius: 16rpx;\n      font-size: 34rpx;\n      font-weight: 500;\n      box-shadow: 0 6rpx 24rpx rgba(230, 81, 0, 0.12);\n      border: 1px solid rgba(230, 81, 0, 0.1);\n      max-width: 90%;\n      line-height: 1.5;\n      transition: all 0.3s ease;\n    }\n  }\n\n  &.appointment_created .bubble {\n    background: #E6F7FF;\n    color: #007AFF;\n    border: 1px solid #91D5FF;\n  }\n\n  &.appointment_cancelled .bubble {\n    background: #FFF1F0;\n    color: #d71100;\n    border: 1px solid #FFA39E;\n  }\n}\n\n.time {\n  font-size: 20rpx;\n  color: #999;\n  margin-top: 12rpx;\n  text-align: right;\n}\n\n.avatar {\n  width: 80rpx;\n  height: 80rpx;\n  border-radius: 12rpx;\n  margin: 0 20rpx;\n  flex-shrink: 0;\n  background-color: #eee;\n}\n\n.msg-content {\n  display: flex;\n  flex-direction: column;\n  max-width: calc(100% - 120rpx - 60rpx);\n}\n\n.bubble {\n  background: #fff;\n  padding: 20rpx 24rpx;\n  border-radius: 16rpx;\n  font-size: 30rpx;\n  line-height: 1.5;\n  word-break: break-all;\n  box-shadow: 0 2rpx 8rpx rgba(0,0,0,0.05);\n}\n\n.msg-image {\n  max-width: 450rpx;\n  max-height: 400rpx;\n  border-radius: 12rpx;\n  display: block;\n  background-color: #e9e9e9;\n}\n\n.location-msg {\n  width: 480rpx;\n  border-radius: 12rpx;\n  overflow: hidden;\n  background-color: #fefefe;\n  box-shadow: 0 2rpx 8rpx rgba(0,0,0,0.05);\n\n  .map-thumb {\n    width: 100%;\n    height: 280rpx;\n    display: block;\n  }\n\n  .map-info {\n    padding: 15rpx 20rpx;\n    background-color: #fff;\n  }\n\n  .map-title {\n    font-size: 28rpx;\n    font-weight: bold;\n    color: #333;\n    display: block;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    margin-bottom: 8rpx;\n  }\n\n  .map-address {\n    font-size: 24rpx;\n    color: #777;\n    display: block;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n}\n\n\n.revoked-text {\n  font-size: 24rpx;\n  color: #999;\n}\n\n.input-bar {\n  position: fixed;\n  left: 0;\n  right: 0;\n  display: flex;\n  align-items: center;\n  padding: 15rpx 20rpx;\n  padding-bottom: calc(15rpx + env(safe-area-inset-bottom));\n  background: #f8f8f8;\n  border-top: 1rpx solid #e0e0e0;\n  transition: bottom 0.2s ease-out;\n  z-index: 100;\n  box-sizing: border-box;\n\n  .icon-btn {\n    width: 56rpx;\n    height: 56rpx;\n    margin: 0 10rpx;\n    flex-shrink: 0;\n  }\n\n  .input {\n    flex: 1;\n    height: 76rpx;\n    padding: 0 28rpx;\n    background: #fff;\n    border-radius: 40rpx;\n    font-size: 28rpx;\n  }\n\n  .send-btn {\n    height: 72rpx;\n    padding: 0 36rpx;\n    line-height: 72rpx;\n    background: #000000;\n    color: white;\n    border-radius: 40rpx;\n    font-size: 28rpx;\n    margin-left: 10rpx;\n    flex-shrink: 0;\n  }\n}\n</style>\n","import MiniProgramPage from 'D:/peng.folder/fengdian-main/蜂点到家/pages/chatDetail/chatDetail.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","getCurrentInstance","uni","nextTick","uniCloud","onLoad","onReady","onShow","onHide","onUnmounted","MiniProgramPage"],"mappings":"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"}