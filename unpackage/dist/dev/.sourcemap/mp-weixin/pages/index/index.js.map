{"version":3,"file":"index.js","sources":["pages/index/index.vue","../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaW5kZXgvaW5kZXgudnVl"],"sourcesContent":["<template>\n\t<view class=\"header-emptybox\">\n\t\t<text class=\"profile-title\">首页</text>\n\t</view>\n  <view>\n    <!-- 地图容器 -->\n    <view class=\"map-container\">\n      <map\n        :latitude=\"latitude\"\n        :longitude=\"longitude\"\n        :scale=\"16\"\n        show-location\n        style=\"width:100%; height:420rpx;\"\n      />\n      <button class=\"location-button\" @click=\"getUserLocation\">\n        <image src=\"/static/images/my location.png\" mode=\"aspectFit\" />\n      </button>\n    </view>\n\n    <!-- 分类导航 -->\n    <view class=\"scroollNav\">\n      <view v-if=\"navArr.length === 0\" class=\"empty-state\">\n        <text>暂无分类</text>\n      </view>\n      <view\n        v-for=\"(item, index) in navArr\"\n        :key=\"item._id\"\n        class=\"item\"\n        @click=\"handleNavClick(item._id)\"\n      >\n        <view class=\"pic\">\n          <image\n            :src=\"item.icon || '/static/images/default-icon.png'\"\n            mode=\"aspectFit\"\n            @error=\"handleImageError\"\n          />\n        </view>\n        <view class=\"text\">{{ item.classname }}</view>\n      </view>\n    </view>\n\n    <!-- 新闻资讯 -->\n    <view class=\"news\">\n      <view class=\"pubTitle\"><view class=\"cn\">新闻资讯</view></view>\n      <view\n        v-for=\"(item, index) in newsArr\"\n        :key=\"item._id\"\n        class=\"content\"\n        @click=\"onNewsClick(item._id, index)\"\n      >\n        <view class=\"box\"><NewsItem :item=\"item\" /></view>\n      </view>\n    </view>\n\n    <!-- 关于我们 -->\n    <view class=\"about\">\r\n      <view class=\"pubTitle\"><view class=\"cn\">蜂点到家</view></view>\r\n      <view class=\"content\">\r\n        <view class=\"row\">\r\n          <view>欢迎使用「蜂点到家」小程序</view>\r\n          <view>本平台专注于本地家政与上门服务的高效预约与对接。</view>\r\n          <view>我们致力于为用户打造一个透明、便捷、安全的服务环境。</view>\r\n          <view>每一位服务人员都可以清晰展示自己的服务范围、技能优势和可预约时间。</view>\r\n          <view>无论是家政保洁、家电清洗，还是上门维修，「蜂点到家」都为你提供可靠选择。</view>\r\n          <view>让优质服务直达用户家门，让服务人员高效获取订单，蜂点到家，让服务更简单。</view>\r\n        </view>\r\n      </view>\r\n    </view>\n  </view>\n</template>\n\n<script setup>\r\nimport { onShareAppMessage, onShareTimeline } from '@dcloudio/uni-app'\nimport { ref, onMounted } from 'vue';\nimport NewsItem from '../news-item.vue';\nimport Footer from '../footer.vue';\n\nconst navArr = ref([]);\nconst latitude = ref(0);\nconst longitude = ref(0);\nconst newsArr = ref([]);\n\n// 点击分类：先缓存 catId，再 switchTab 到 previewList\nfunction handleNavClick(categoryId) {\n  console.log('[index] 点击分类，缓存 categoryId=', categoryId);\n  uni.setStorageSync('initialCategoryId', categoryId);\n  uni.switchTab({\n    url: '/pages/previewList/previewList'\n  });\n}\n\nfunction handleImageError(e) {\n  console.error('图片加载失败', e);\n}\n\nfunction getUserLocation() {\n  uni.showLoading({ title: '定位中...' });\n  uni.getLocation({\n    type: 'gcj02',\n    success(res) {\n      uni.hideLoading();\n      latitude.value = res.latitude;\n      longitude.value = res.longitude;\n\t  // 缓存到本地，后面其他页面需要\n      uni.setStorageSync('userLocation', {\n        latitude: res.latitude,\n        longitude: res.longitude\n      });\n    },\n    fail() {\n      uni.hideLoading();\n      uni.showToast({ title: '获取位置失败', icon: 'none' });\n    }\n  });\n}\n\nasync function getNavData() {\n  try {\n    uni.showLoading({ title: '加载中...' });\n    const res = await uniCloud.callFunction({ name: 'getNavData' });\n    uni.hideLoading();\n    if (res.result.code === 0) {\n      navArr.value = res.result.data.filter(i => i.icon && i.classname);\n    }\n  } catch {\n    uni.hideLoading();\n    uni.showToast({ title: '导航加载失败', icon: 'none' });\n  }\n}\n\nasync function getNewsData() {\n  try {\n    const res = await uniCloud.callFunction({ name: 'getNewsData' });\n    if (res.result.data) {\n      newsArr.value = res.result.data.map(item => ({\n        ...item,\n        view_count_display: formatNum(item.view_count),\n        publish_date: formatTime(item.publish_date)\n      }));\n    }\n  } catch {\n    uni.showToast({ title: '新闻加载失败', icon: 'none' });\n  }\n}\n\nfunction formatNum(n) {\n  return n > 10000 ? (n / 10000).toFixed(1) + '万' : n;\n}\nfunction formatTime(d) {\n  const dt = new Date(d);\n  return `${dt.getMonth() + 1}-${dt.getDate()}`;\n}\n\n// index.vue 中的 onNewsClick 函数\nasync function onNewsClick(id, idx) {\n  uni.vibrateShort && uni.vibrateShort();\n  await uniCloud.callFunction({ name: 'upNewsview_count', data: { id } });\n  newsArr.value[idx].view_count++;\n  newsArr.value[idx].view_count_display = formatNum(newsArr.value[idx].view_count);\n  \n  // 新增跳转到新闻详情页\n  uni.navigateTo({\n    url: `/pages/newsDetail/newsDetail?id=${id}`\n  });\n}\n\n\n\nonMounted(() => {\n  getNavData();\n  getUserLocation();\n  getNewsData();\n});\n\nfunction handleLogout() {\n  // 1. 清除本地缓存\n  uni.removeStorageSync('userinfo');\n  uni.removeStorageSync('token'); // 如果有token的话\n\n  // 2. 触发全局退出登录事件\n  // 这会通知 App.vue 停止监听并移除 tabBar 角标\n  uni.$emit('user-logout');\n\n  // 3. 提示用户并跳转到登录页\n  uni.showToast({\n    title: '已退出登录',\n    icon: 'none'\n  });\n\n  // 使用 reLaunch 跳转到登录页，清空页面栈\n  uni.reLaunch({\n    url: '/pages/login/login'\n  });\n}\n\n\nonShareAppMessage(() => {\n  return {\n    title: '蜂点到家 - 本地靠谱的家政技工平台',\n    path: '/pages/index/index'\n  }\n})\n\nonShareTimeline(() => {\n  return {\n    title: '蜂点到家 - 快速预约本地服务'\n  }\n})\n\n</script>\n\n\n\n<style lang=\"scss\">\n/* 全局变量：点缀色、文字色、背景色、分割线 */\n:root {\n  --primary-accent: #007AFF;   /* 黄色点缀 */\n  --text-main:    #333333;     /* 主要文字 (深灰) */\n  --text-sub:     #666666;     /* 次要文字 (中灰) */\n  --line-gray:    #E5E5E5;     /* 分割线 (浅灰) */\n  --bg-white:     #FFFFFF;     /* 白色 */\n  --bg-light:     #F7F8FA;     /* 浅灰背景 */\n  --blue-accent:  #3978F7;     /* 交互高亮蓝 */\n  --globalcolor:  #333333;     /* 全局颜色 */\n}\n\n.header-emptybox {\n  width: 100%;\n  height: 230rpx;\n  position: relative; // 必须加这个，才能让子元素绝对定位生效\n}\n.profile-title {\n  position: absolute;           // ✅ 缺失的关键属性\n  font-size: 55rpx;          // 字体大\n  font-weight: 580;          // 半粗体，接近 Airbnb 标题\n  color: #1c1c1e;            // 深灰，比纯黑柔和\n  font-family: \"Helvetica Neue\", \"PingFang SC\", \"Helvetica\", \"Arial\", sans-serif; // Airbnb 常用字体替代\n  top: 130rpx;                    // ✅ 从容器顶部下移 50rpx\n  // left: 50%;                     // 居中基准线\n  left: 35rpx;\n  // transform: translateX(-165%);  // 居中\n}\n\n/* 地图容器 */\n.map-container {\n  position: relative;\n  margin-top: 20rpx;\n  padding: 0 30rpx 20rpx;\n  background: var(--bg-white);\n\n  map {\n    width: 100%;\n    height: 420rpx;\n    border-radius: 24rpx;\n    overflow: hidden;\n    border: 1rpx solid rgba(0, 0, 0, 0.1);\n    background: rgba(255, 255, 255, 0.8);\n    box-shadow: 0 8rpx 20rpx rgba(0, 0, 0, 0.1);\n  }\n\n  .location-button {\n    position: absolute;\n    right: 50rpx;\n    bottom: 40rpx;\n    width: 70rpx;\n    height: 70rpx;\n    border-radius: 50%;\n    background: var(--bg-white);\n    box-shadow: 0 4rpx 10rpx rgba(0, 0, 0, 0.2);\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding: 0;\n    border: none;\n    transition: transform 0.1s;\n\n    &:active {\n      transform: scale(0.95);\n    }\n\n    image {\n      width: 50rpx;\n      height: 50rpx;\n    }\n  }\n}\n\n/* 导航菜单 */\n.scroollNav {\n  padding: 20rpx 30rpx;\n  display: grid;\n  grid-template-columns: repeat(5, 1fr);\n  grid-gap: 20rpx;\n\n.item {\n    text-align: center;\n    transition: transform 0.1s;\n\n    &:active {\n  transform: scale(0.95);\n}\n\n.pic {\n      width: 80rpx;\n      height: 80rpx;\n      margin: 0 auto;\n      image {\n        width: 100%;\n        height: 100%;\n}\n    }\n\n.text {\n      font-size: 26rpx;\n      color: #333333;\n      padding-top: 8rpx;\n    }\n  }\n}\n\n.empty-state {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100rpx;\n  color: var(--text-color);\n  font-size: 28rpx;\n}\n\n/* 新闻资讯 */\n.news {\n  padding: 30rpx 30rpx;\n  .content {\n    transition: transform 0.1s;\n    &:active { transform: scale(0.98); }\n    .box {\n      background: #fff;\n      border-radius: 16rpx;\n      box-shadow: 0 2rpx 8rpx rgba(0,0,0,0.04);\n      padding: 8rpx 12rpx;\n    }\n  }\n}\n\n/* 关于我们 */\n.about {\n  padding: 50rpx 30rpx 80rpx;\n  .content {\n    .row {\n      line-height: 1.6em;\n      text-indent: 2em;\n      font-size: 32rpx;\n      padding: 20rpx 0;\n      border-bottom: 1rpx dashed var(--primary-accent);\n      color: var(--globalcolor);\n      &:first-child { padding-top: 0; }\n      &:last-child  { border-bottom: none; padding-bottom: 0; }\n    }\n  }\n}\n\n.pubTitle {\n  position: relative;\n  margin: 0 0 32rpx 0;\n  padding: 0 30rpx 0 30rpx;\n  text-align: left;\n  background: none;\n  .cn {\n    display: inline-block;\n    font-size: 56rpx;\n    font-weight: 700;\n    color: #1a1a1a;\n    letter-spacing: 2rpx;\n    position: relative;\n    padding-left: 22rpx;\n    line-height: 1.2;\n    background: none;\n    &::before {\n      content: '';\n      display: inline-block;\n      width: 10rpx;\n      height: 44rpx;\n      background: var(--primary-accent, #3978F7);\n      border-radius: 5rpx;\n      position: absolute;\n      left: 0;\n      top: 50%;\n      transform: translateY(-50%);\n    }\n  }\n  &::after {\n    content: '';\n    display: block;\n    width: 100%;\n    height: 2rpx;\n    background: linear-gradient(90deg, #e3eaf3 0%, #f7f8fa 100%);\n    margin-top: 12rpx;\n    border-radius: 1rpx;\n  }\n}\n\n.nsitem {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  background: #fff;\n  border-radius: 16rpx;\n  box-shadow: 0 2rpx 8rpx rgba(0,0,0,0.06);\n  margin-bottom: 4rpx;\n  min-height: 150rpx;\n  overflow: hidden;\n  .pic {\n    width: 220rpx;\n    height: 150rpx;\n    flex-shrink: 0;\n    .img {\n  width: 100%;\n      height: 100%;\n      border-radius: 16rpx 0 0 16rpx;\n      object-fit: cover;\n      display: block;\n    }\n  }\n  .text {\n    flex: 1 1 0%;\n    min-width: 0;\n    height: 150rpx;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    padding: 18rpx 24rpx;\n    box-sizing: border-box;\n    .title {\n      line-height: 1.4em;\n      color: var(--primary-accent);\n      font-size: 32rpx;\n      text-overflow: ellipsis;\n      overflow: hidden;\n      display: -webkit-box;\n      -webkit-line-clamp: 2;\n      -webkit-box-orient: vertical;\n      margin-bottom: 16rpx;\n      white-space: normal;\n    }\n    .info {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n      gap: 32rpx;\n      flex-wrap: nowrap;\n      font-size: 28rpx;\n      color: var(--text-sub);\n      .block {\n        display: flex;\n        align-items: center;\n        white-space: nowrap;\n      }\n      .icon-class {\n        color: var(--text-sub);\n        margin-right: 6rpx;\n      }\n    }\n  }\n}\n</style>","import MiniProgramPage from 'D:/peng.folder/fengdian-main/蜂点到家/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","uniCloud","onMounted","onShareAppMessage","onShareTimeline","MiniProgramPage"],"mappings":"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"}