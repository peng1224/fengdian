{"version":3,"file":"appointmentForm.js","sources":["pages/appointmentForm/appointmentForm.vue","../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYXBwb2ludG1lbnRGb3JtL2FwcG9pbnRtZW50Rm9ybS52dWU"],"sourcesContent":["<template>\n  <view class=\"page-container\">\n    <view class=\"form-container\">\n      <view class=\"form-title\">预约服务</view>\n      <view class=\"form-subtitle\">师傅号码: {{ targetPhone }}</view>\n\n      <view class=\"form-item\">\n        <text class=\"label\">选择服务时间</text>\n        <view class=\"date-selector\">\n          <scroll-view class=\"scroll-view\" scroll-x=\"true\" show-scrollbar=\"false\">\n            <view\n              v-for=\"(day, index) in availableDays\"\n              :key=\"index\"\n              :class=\"['day-item', { 'active-day': selectedDate === day.dateString }]\"\n              @click=\"selectDate(day.dateString)\"\n            >\n              <view class=\"day-name\">{{ day.name }}</view>\n              <view class=\"day-date\">{{ day.shortDate }}</view>\n            </view>\n          </scroll-view>\n        </view>\n        <view class=\"time-slot-container\">\n          <view v-if=\"isLoading\" class=\"loading-text\">时间加载中...</view>\n          <view v-else-if=\"timeSlots.length === 0\" class=\"no-slots-text\">暂无可用时间段</view>\n          <view v-else class=\"time-slot-grid\">\n            <view\n              v-for=\"(slot, index) in timeSlots\"\n              :key=\"index\"\n              :class=\"['time-slot-item', { 'selected-slot': selectedTime === slot.time, 'booked-slot': slot.isBooked, 'past-slot': slot.isPast }]\"\n              @click=\"selectTime(slot)\"\n            >\n              {{ slot.time }}\n            </view>\n          </view>\n        </view>\n      </view>\n\n  <view class=\"form-item\">\n    <text class=\"label\">服务地点 <text class=\"required-star\">*</text></text>\n    <!-- 点击触发：小程序走地图选点，App 端走定位+逆地址 -->\n    <view class=\"location-selector\" @click=\"handleChooseLocation\">\n      <view class=\"location-text-wrapper\">\n        <text v-if=\"serviceAddress.name\" class=\"location-name\">{{ serviceAddress.name }}</text>\n        <text v-if=\"serviceAddress.address\" class=\"location-address\">{{ serviceAddress.address }}</text>\n        <text v-if=\"!serviceAddress.name\" class=\"location-placeholder\">点击选择服务地点</text>\n      </view>\n      <uni-icons type=\"location-filled\" size=\"24\" color=\"#999\" />\n    </view>\n    <input\n      class=\"detail-address-input\"\n      v-model=\"serviceAddress.detail\"\n      placeholder=\"请补充详细地址，如楼层、门牌号\"\n    />\n  </view>\n\n      <view class=\"form-item\">\n        <text class=\"label\">服务需求 <text class=\"required-star\">*</text></text>\n        <textarea class=\"remark-textarea\" v-model=\"remark\" placeholder=\"请详细描述您的服务需求，例如：清洗两台挂式空调，型号为...\" />\n      </view>\n\n      <view class=\"payment-notice\">\n          <view class=\"notice-title\">\n              <uni-icons type=\"help-filled\" size=\"18\" color=\"#ff9900\"></uni-icons>\n              <text>预约须知</text>\n          </view>\n          <view class=\"notice-content\">\n              <text>为保障双方权益，预约需预付30元师傅跑腿费，该费用可抵扣总服务费。</text>\n              <view class=\"notice-list-item\">  ● 若师傅取消预约，跑腿费将自动全额原路退回。</view>\n              <view class=\"notice-list-item\">  ● 用户取消退款规则：</view>\n              <view class=\"notice-list-item\">  ● 若您在服务开始前 \"24小时以上\" 取消，将 \"全额退款\"。</view>\n              <view class=\"notice-list-item\">  ● 若您在服务开始前 \"12小时（含）至24小时内\" 取消，将退还 \"70%\" 的费用。</view>\n              <view class=\"notice-list-item\">  ● 若您在服务开始前 \"2小时（含）至12小时内\" 取消，将退还 \"50%\" 的费用。</view>\n              <view class=\"notice-list-item\">  ● 服务事件开始 \"1小时\" 后不可取消预约。</view>\r\n\t\t\t  <view class=\"notice-list-item\">  ● 对订单有任何争议，您可以在“我的预约”中点击“联系客服”按钮发起申诉。</view>\n          </view>\n      </view>\n\n      <button class=\"submit-btn\" @click=\"submitForm\" :disabled=\"!selectedTime\">\n        支付并确认预约\n      </button>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted, watch } from 'vue';\nimport { onLoad } from '@dcloudio/uni-app';\n\n// --- 响应式状态定义 ---\nconst targetUserId = ref('');\nconst targetPhone = ref('');\nconst remark = ref('');\nconst userInfo = ref(uni.getStorageSync('userinfo') || {});\n\nconst availableDays = ref([]);\nconst timeSlots = ref([]);\nconst selectedDate = ref('');\nconst selectedTime = ref('');\nconst isLoading = ref(false);\n\n// 地址相关的响应式状态\nconst serviceAddress = ref({\n  name: '',      // 地点名称，如「XX小区」\n  address: '',   // 完整地址\n  latitude: null,\n  longitude: null,\n  detail: ''     // 手动输入的详细地址，如「A栋1201室」\n});\n\n// 腾讯地图Key\nconst QQ_MAP_KEY_MP = 'ZOYBZ-S7V6G-OSQQ2-QA54H-2PBHE-CXF46';\nconst QQ_MAP_KEY_APP = '3QUBZ-FFCCB-6GYUO-NQI2R-WDUB5-BJFIY';\n\n// --- 生命周期函数 ---\nonLoad((options) => {\n  const { userId, accountPhoneNumber } = options;\n  if (userId) {\n    targetUserId.value = userId;\n    targetPhone.value = accountPhoneNumber;\n  } else {\n    uni.showToast({ title: '缺少师傅信息', icon: 'error' });\n    uni.navigateBack();\n  }\n});\n\nonMounted(() => {\n  generateAvailableDays();\n  if (availableDays.value.length > 0) {\n    selectDate(availableDays.value[0].dateString);\n  }\n});\n\nwatch(selectedDate, (newDate) => {\n  if (newDate) {\n    selectedTime.value = '';\n    fetchBookedSlots(newDate);\n  }\n});\n\n// --- 方法定义 ---\n\n// 选择地点的方法\nconst handleChooseLocation = () => {\n    uni.chooseLocation({\n        latitude: serviceAddress.value.latitude || undefined,\n        longitude: serviceAddress.value.longitude || undefined,\n        success: (loc) => {\n            let name = loc.name;\n            let address = loc.address;\n\n            if (!name && address) {\n                const parts = address.split(/[,，·-]/);\n                if (parts.length > 0) {\n                    name = parts[0].trim();\n                    address = parts.slice(1).join('').trim() || address;\n                } else {\n                    name = address;\n                }\n            } else if (name && address && address.startsWith(name)) {\n                address = address.substring(name.length).trim();\n            }\n\n            serviceAddress.value = {\n                ...serviceAddress.value,\n                name: name,\n                address: address,\n                latitude: loc.latitude,\n                longitude: loc.longitude\n            };\n        },\n        fail: (err) => {\n            console.error('选择地点失败', err);\n            if (err.errMsg === 'chooseLocation:fail cancel' || err.errMsg === 'chooseLocation:fail') {\n                uni.showToast({ title: '已取消选点', icon: 'none' });\n            } else {\n                uni.showToast({ title: '选点失败: ' + err.errMsg, icon: 'none' });\n            }\n        }\n    });\n};\n\n\nconst generateAvailableDays = () => {\n  const days = [];\n  const today = new Date();\n  const dayNames = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'];\n  const dayNamesShort = ['今天', '明天', '后天'];\n\n  for (let i = 0; i < 7; i++) {\n    const date = new Date(today);\n    date.setDate(today.getDate() + i);\n    const year = date.getFullYear();\n    const month = (date.getMonth() + 1).toString().padStart(2, '0');\n    const dayOfMonth = date.getDate().toString().padStart(2, '0');\n    let name = (i < 3) ? dayNamesShort[i] : dayNames[date.getDay()];\n    days.push({\n      name: name,\n      shortDate: `${month}-${dayOfMonth}`,\n      dateString: `${year}-${month}-${dayOfMonth}`,\n    });\n  }\n  availableDays.value = days;\n};\n\nconst generateStandardTimeSlots = () => {\n  const slots = [];\n  for (let i = 9; i <= 18; i++) {\n    slots.push({\n      time: `${i.toString().padStart(2, '0')}:00`,\n      isBooked: false,\n      isPast: false,\n    });\n  }\n  return slots;\n};\n\nconst selectDate = (dateString) => {\n  selectedDate.value = dateString;\n};\n\nconst fetchBookedSlots = async (date) => {\n  if (!targetUserId.value) return;\n  isLoading.value = true;\n  timeSlots.value = [];\n  try {\n    const res = await uniCloud.callFunction({\n      name: 'getAppointmentsByWorker',\n      data: { workerId: targetUserId.value, date: date },\n    });\n    const bookedHours = res.result.data || [];\n    const standardSlots = generateStandardTimeSlots();\n    const today = new Date();\n    const todayString = `${today.getFullYear()}-${(today.getMonth() + 1).toString().padStart(2, '0')}-${today.getDate().toString().padStart(2, '0')}`;\n    const currentHour = today.getHours();\n    timeSlots.value = standardSlots.map(slot => {\n      const slotHour = parseInt(slot.time.split(':')[0]);\n      const isPast = (date === todayString && slotHour <= currentHour);\n      return {\n        ...slot,\n        isBooked: bookedHours.includes(slot.time),\n        isPast: isPast,\n      };\n    });\n  } catch (error) {\n    console.error('获取预约时段失败:', error);\n    uni.showToast({ title: '加载时间失败', icon: 'none' });\n    timeSlots.value = generateStandardTimeSlots();\n  } finally {\n    isLoading.value = false;\n  }\n};\n\nconst selectTime = (slot) => {\n  if (slot.isBooked) {\n    uni.showToast({ title: '该时段已被预约', icon: 'none' });\n    return;\n  }\n  if (slot.isPast) {\n    uni.showToast({ title: '不能选择过去的时间', icon: 'none' });\n    return;\n  }\n  selectedTime.value = slot.time;\n};\n\nconst submitForm = async () => {\n  // 1. 校验\n  if (!selectedTime.value) {\n    return uni.showToast({ title: '请选择服务时间', icon: 'none' });\n  }\n  if (!serviceAddress.value.name || !serviceAddress.value.address) {\n    return uni.showToast({ title: '请选择服务地点', icon: 'none' });\n  }\n  if (!serviceAddress.value.detail.trim()) {\n    return uni.showToast({ title: '请填写详细地址', icon: 'none' });\n  }\n  if (!remark.value.trim()) {\n    return uni.showToast({ title: '请填写具体服务需求', icon: 'none' });\n  }\n  if (!userInfo.value._id) {\n    return uni.showToast({ title: '请先登录', icon: 'none' });\n  }\n\n  // 2. 提示支付中\n  uni.showLoading({ title: '正在支付跑腿费...' });\n\n  try {\n    // 2.1 获取 openid（小程序端 JSAPI 支付必需）\n    const { code } = await uni.login({ provider: 'weixin' });\n    const { result: openRes } = await uniCloud.callFunction({\n      name: 'getOpenidByCode',\n      data: { code }\n    });\n    const openid = openRes.openid;\n\n    // 2.2 调用下单云函数，金额单位为分（30元 = 3000分）\n    const outTradeNo = 'order_' + Date.now(); // 你也可以加上业务前缀\n    const total_fee = 30; // 定义固定的支付金额（30元 = 3000分）\n    const { result: payParams } = await uniCloud.callFunction({\n      name: 'createPayOrder',\n      data: {\n        openid,\n        out_trade_no: outTradeNo,\n        total_fee: total_fee, // 使用定义的 total_fee\n        body: '跑腿服务费30元'\n      }\n    });\n\n    // 2.3 发起微信支付\n    await new Promise((resolve, reject) => {\n      uni.requestPayment({\n        provider: 'wxpay',\n        ...payParams,\n        success: resolve,\n        fail: (err) => reject(err)\n      });\n    });\n\n    // 3. 支付成功后创建预约\n    uni.showLoading({ title: '正在提交预约...' });\n    const res = await uniCloud.callFunction({\n      name: 'createAppointment',\n      data: {\n        workerId:       targetUserId.value,\n        workerPhone:    targetPhone.value,\n        userId:         userInfo.value._id,\n        userPhone:      userInfo.value.phoneNumber,\n        userName:       userInfo.value.name || '匿名用户',\n        serviceDate:    selectedDate.value,\n        serviceHour:    selectedTime.value,\n        serviceAddress: serviceAddress.value,\n        remark:         remark.value,\n        orderId:        outTradeNo,      // 记录支付订单号\n        payStatus:      'PAID',          // 标记已支付\n        total_fee:      total_fee,        // 使用定义的 total_fee\r\n\t\tclientInfo: getApp().globalData?.clientInfo || uni.getSystemInfoSync()\n      }\n    });\n    uni.hideLoading();\n\n    if (res.result.success) {\n      uni.showToast({ title: '预约成功！', icon: 'success' });\n      setTimeout(() => uni.navigateBack(), 1500);\n    } else {\n      uni.showToast({ title: res.result.message || '预约失败', icon: 'none' });\n      if (res.result.code === 'SLOT_TAKEN') {\n        fetchBookedSlots(selectedDate.value);\n      }\n    }\n\n  } catch (err) {\n    uni.hideLoading();\n    // 区分支付失败/取消 vs 网络错误\n    if (err && err.errMsg && err.errMsg.includes('requestPayment:fail')) {\n      // 用户取消或支付失败\n      uni.showToast({ title: '支付未完成，预约已取消', icon: 'none' });\n    } else {\n      // 其他异常\n      uni.showToast({ title: '网络或系统错误，请稍后重试', icon: 'none' });\n      console.error('submitForm error:', err);\n    }\n  }\n};\n</script>\n<style scoped>\n.page-container {\n  background-color: #f8f8f8;\n  min-height: 100vh;\n}\n.form-container {\n  padding: 40rpx;\n  background-color: #ffffff;\n}\n.form-title {\n  font-size: 44rpx;\n  font-weight: bold;\n  color: #333;\n  margin-bottom: 10rpx;\n}\n.form-subtitle {\n  font-size: 24rpx;\n  color: #999;\n  margin-bottom: 40rpx;\n}\n.form-item {\n  margin-bottom: 40rpx;\n}\n.label {\n  font-size: 30rpx;\n  color: #333;\n  font-weight: 500;\n  margin-bottom: 20rpx;\n  display: block;\n}\n.label .required-star {\n  color: #ff0000;\n  margin-left: 5rpx;\n}\n.date-selector .scroll-view {\n  white-space: nowrap;\n  width: 100%;\n}\n.day-item {\n  display: inline-block;\n  text-align: center;\n  padding: 20rpx;\n  margin-right: 20rpx;\n  border: 1px solid #eee;\n  border-radius: 16rpx;\n  transition: all 0.3s;\n  background-color: #f7f7f7;\n}\n.day-item.active-day {\n  background-color: #30d158;\n  color: #fff;\n  border-color: #30d158;\n}\n.day-name {\n  font-size: 28rpx;\n  font-weight: bold;\n}\n.day-date {\n  font-size: 24rpx;\n  margin-top: 5rpx;\n}\n.day-item.active-day .day-name,\n.day-item.active-day .day-date {\n  color: #fff;\n}\n.time-slot-container {\n  margin-top: 30rpx;\n}\n.loading-text, .no-slots-text {\n  text-align: center;\n  color: #999;\n  padding: 40rpx 0;\n}\n.time-slot-grid {\n  display: grid;\n  grid-template-columns: repeat(4, 1fr);\n  gap: 20rpx;\n}\n.time-slot-item {\n  padding: 20rpx 10rpx;\n  border: 1px solid #ddd;\n  border-radius: 12rpx;\n  text-align: center;\n  font-size: 28rpx;\n  color: #333;\n  background-color: #fff;\n  transition: all 0.2s ease-in-out;\n}\n.time-slot-item:active {\n  transform: scale(0.95);\n}\n.time-slot-item.selected-slot {\n  background-color: #30d158;\n  color: #fff;\n  border-color: #30d158;\n}\n.time-slot-item.booked-slot {\n  background-color: #f2f2f2;\n  color: #aaa;\n  border-color: #e5e5e5;\n  cursor: not-allowed;\n  text-decoration: line-through;\n}\n.time-slot-item.past-slot {\n  background-color: #f9f9f9;\n  color: #ccc;\n  border-color: #f0f0f0;\n  text-decoration: line-through;\n  cursor: not-allowed;\n}\n.remark-textarea {\n  width: 100%;\n  height: 150rpx;\n  border: 1px solid #e5e5e5;\n  padding: 20rpx;\n  border-radius: 12rpx;\n  font-size: 28rpx;\n  box-sizing: border-box;\n  background-color: #fdfdfd;\n}\n/* 【修改】提交按钮样式，边距调整 */\n.submit-btn {\n  width: 100%;\n  height: 96rpx;\n  background: linear-gradient(to right, #30d158, #28a745);\n  color: #fff;\n  font-size: 32rpx;\n  border-radius: 48rpx;\n  line-height: 96rpx;\n  text-align: center;\n  /* margin-top: 40rpx; */ /* 由下方的 notice 盒子控制 */\n  box-shadow: 0 4px 10px rgba(48, 209, 88, 0.3);\n  transition: all 0.3s;\n}\n.submit-btn:active {\n  opacity: 0.8;\n}\n.submit-btn[disabled] {\n  background: #c8c9cc;\n  color: #fff;\n  box-shadow: none;\n}\n.location-selector {\n  display: flex;\n  align-items: center;\n  width: 100%;\n  min-height: 100rpx;\n  border: 1px solid #e5e5e5;\n  padding: 15rpx 20rpx;\n  border-radius: 12rpx;\n  box-sizing: border-box;\n  background-color: #fdfdfd;\n  transition: background-color 0.2s;\n}\n.location-selector:active {\n  background-color: #f0f0f0;\n}\n.location-text-wrapper {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n}\n.location-placeholder {\n  font-size: 28rpx;\n  color: #999;\n}\n.location-name {\n  font-size: 30rpx;\n  font-weight: 500;\n  color: #333;\n  margin-bottom: 5rpx;\n}\n.location-address {\n  font-size: 24rpx;\n  color: #666;\n}\n.detail-address-input {\n  width: 100%;\n  height: 88rpx;\n  border: 1px solid #e5e5e5;\n  padding: 0 20rpx;\n  border-radius: 12rpx;\n  font-size: 28rpx;\n  box-sizing: border-box;\n  background-color: #fdfdfd;\n  margin-top: 20rpx;\n}\n/* 【新增】支付提示卡片的样式 */\n.payment-notice {\n    background-color: #fffaf0;\n    border: 1px solid #ffe5b3;\n    border-radius: 16rpx;\n    padding: 20rpx;\n    margin-bottom: 40rpx;\n    font-size: 24rpx;\n    color: #666;\n    line-height: 1.6;\n}\n.notice-title {\n    display: flex;\n    align-items: center;\n    font-size: 28rpx;\n    font-weight: 500;\n    color: #333;\n    margin-bottom: 10rpx;\n}\n.notice-title text {\n    margin-left: 10rpx;\n    color: #d98600;\n}\n.notice-content {\n    padding-left: 5rpx;\n}\n.notice-list-item {\n    margin-top: 8rpx;\n    padding-left: 5rpx;\n    font-size: 22rpx;\n    color: #888;\n}\n</style>","import MiniProgramPage from 'D:/peng.folder/fengdian-main/蜂点到家/pages/appointmentForm/appointmentForm.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","onLoad","onMounted","watch","uniCloud"],"mappings":"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"}