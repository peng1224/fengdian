"use strict";const e=require("../../common/vendor.js");if(!Array){e.resolveComponent("uni-file-picker")()}const i={__name:"applyTechnician",setup(i){const a=e.reactive({realName:"",idCard:"",skills:"",certificates:[]}),t=e.ref([]),n=e.ref(!1);function o(e){const i=e.tempFiles||[];a.certificates=i.map((e=>e.url))}async function l(){const i=e.index.getStorageSync("userinfo");if(!i||!i._id)return e.index.showToast({title:"请先登录",icon:"none"});if(!a.realName||!a.idCard)return e.index.showToast({title:"真实姓名和身份证号为必填项",icon:"none"});n.value=!0,e.index.showLoading({title:"正在提交..."});try{const{result:t}=await e.nr.callFunction({name:"applyForTechnician",data:{uid:i._id,applicationData:a}});if(!t.success)throw new Error(t.message||"提交失败");e.index.showToast({title:"申请已提交！",icon:"success"}),i.technicianApplicationStatus="pending",e.index.setStorageSync("userinfo",i),setTimeout((()=>{e.index.switchTab({url:"/pages/profile/profile"})}),1500)}catch(t){e.index.showToast({title:t.message||"提交申请时发生错误",icon:"none"})}finally{n.value=!1,e.index.hideLoading()}}return(i,s)=>({a:a.realName,b:e.o((e=>a.realName=e.detail.value)),c:a.idCard,d:e.o((e=>a.idCard=e.detail.value)),e:a.skills,f:e.o((e=>a.skills=e.detail.value)),g:e.o(o),h:e.o(i.onUploadFail),i:e.o((e=>t.value=e)),j:e.p({"file-mediatype":"image",mode:"grid",limit:"3",modelValue:t.value}),k:e.t(n.value?"提交中...":"确认提交申请"),l:e.o(l),m:n.value,n:n.value})}},a=e._export_sfc(i,[["__scopeId","data-v-504b7c58"]]);wx.createPage(a);
