"use strict";const e=require("../../common/vendor.js"),t={__name:"previewList",setup(t){const a=e.ref([]),i=e.ref([]),n=e.ref([]),l=e.ref([]),u=e.ref(!1),o=e.ref(0),r=e.ref("all"),c=e.ref(!1),s=e.ref(!1),d=e.ref(null);let v=0,g=null;function f(){const e=d.value;if(!e)return;const t=a.value.findIndex((t=>t.type===e));-1!==t&&p(e,t),d.value=null}function p(t,a){r.value!==t&&(s.value=!0,setTimeout((()=>{r.value=t,c.value=!0,l.value="all"===t?n.value:n.value.filter((e=>e.categories.includes(t))),e.nextTick$1((()=>function(t){e.index.createSelectorQuery().select(`#nav_${t}`).boundingClientRect().select(".nav-scroll").boundingClientRect().exec((([e,t])=>{if(!e||!t)return;const a=v+(e.left+e.width/2)-t.width/2;o.value=a,v=a}))}(a))),setTimeout((()=>{s.value=!1,c.value=!1}),300)}),10))}function m(e){g&&clearTimeout(g),g=setTimeout((()=>{v=e.detail.scrollLeft}),100)}return e.watch(a,(e=>{e.length>0&&d.value&&f()})),e.onShow((()=>{const t=e.index.getStorageSync("initialCategoryId");t&&(e.index.removeStorageSync("initialCategoryId"),d.value=t,a.value.length>0&&f())})),e.onMounted((async()=>{e.index.showLoading({title:"加载中..."}),await async function(){const{result:t}=await e.nr.callFunction({name:"getNavData"}),n=t.data||[];i.value=n,a.value=[{type:"all",name:"全部"}].concat(n.map((e=>({type:e._id,name:e.classname}))))}(),await async function(){const{result:t}=await e.nr.callFunction({name:"getAllHomepageForpreviewList"}),a=t.data||[],u=e.index.getStorageSync("userLocation")||{},o=a.map((e=>{let t="";if(u.latitude&&e.latitude){t=`${function(e,t,a,i){const n=e=>e*Math.PI/180,l=6371,u=n(a-e),o=n(i-t),r=Math.sin(u/2)**2+Math.cos(n(e))*Math.cos(n(a))*Math.sin(o/2)**2;return 2*l*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))}(u.latitude,u.longitude,e.latitude,e.longitude).toFixed(1)}公里`}const a=(e.categories||[]).map((e=>{const t=i.value.find((t=>t._id===e));return t?t.classname:""})).filter(Boolean).join(", ")||"暂无分类";return{id:e._id,title:(e.name||"未命名").slice(0,5),serviceArea:e.serviceArea,avatar:e.avatar||"",description:e.description||"",skills:e.skills||[],categories:e.categories||[],distance:t,categoriesDisplay:a}}));n.value=o,l.value=o}(),u.value=!0,e.index.hideLoading()})),(t,i)=>e.e({a:e.f(a.value,((t,a,i)=>({a:e.t(t.name),b:t.type,c:`nav_${a}`,d:r.value===t.type?1:"",e:r.value===t.type&&c.value?1:"",f:e.o((e=>p(t.type,a)),t.type)}))),b:o.value,c:e.o(m),d:!u.value},u.value?e.e({f:l.value.length>0},l.value.length>0?{g:e.f(l.value,((t,a,i)=>({a:e.t(t.serviceArea||"未知"),b:e.t(t.distance),c:t.distance?"":1,d:t.avatar||"/static/images/default-avatar.jpg",e:e.t(t.title),f:e.t(t.categoriesDisplay||"暂无分类"),g:e.t(t.description||""),h:e.f(t.skills,((t,a,i)=>({a:e.t(t),b:a}))),i:t.id,j:e.o((a=>{var i;(i=t.id)&&e.index.navigateTo({url:`/pages/HomepageDetail/HomepageDetail?id=${i}`})}),t.id)})))}:{}):{e:e.f(3,((e,t,a)=>({a:e})))},{h:s.value?1:""})}};wx.createPage(t);
