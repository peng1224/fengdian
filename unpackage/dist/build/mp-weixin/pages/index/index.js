"use strict";const e=require("../../common/vendor.js"),t=require("../../common/assets.js");Math||n();const n=()=>"../news-item.js",i={__name:"index",setup(n){const i=e.ref([]),a=e.ref(0),o=e.ref(0),d=e.ref([]);function c(e){console.error("图片加载失败",e)}function s(){e.index.showLoading({title:"定位中..."}),e.index.getLocation({type:"gcj02",success(t){e.index.hideLoading(),a.value=t.latitude,o.value=t.longitude,e.index.setStorageSync("userLocation",{latitude:t.latitude,longitude:t.longitude})},fail(){e.index.hideLoading(),e.index.showToast({title:"获取位置失败",icon:"none"})}})}function u(e){return e>1e4?(e/1e4).toFixed(1)+"万":e}function l(e){const t=new Date(e);return`${t.getMonth()+1}-${t.getDate()}`}return e.onMounted((()=>{!async function(){try{e.index.showLoading({title:"加载中..."});const t=await e.nr.callFunction({name:"getNavData"});e.index.hideLoading(),0===t.result.code&&(i.value=t.result.data.filter((e=>e.icon&&e.classname)))}catch{e.index.hideLoading(),e.index.showToast({title:"导航加载失败",icon:"none"})}}(),s(),async function(){try{const t=await e.nr.callFunction({name:"getNewsData"});t.result.data&&(d.value=t.result.data.map((e=>({...e,view_count_display:u(e.view_count),publish_date:l(e.publish_date)}))))}catch{e.index.showToast({title:"新闻加载失败",icon:"none"})}}()})),(n,l)=>e.e({a:a.value,b:o.value,c:t._imports_0,d:e.o(s),e:0===i.value.length},(i.value.length,{}),{f:e.f(i.value,((t,n,i)=>({a:t.icon||"/static/images/default-icon.png",b:e.o(c,t._id),c:e.t(t.classname),d:t._id,e:e.o((n=>{return i=t._id,console.log("[index] 点击分类，缓存 categoryId=",i),e.index.setStorageSync("initialCategoryId",i),void e.index.switchTab({url:"/pages/previewList/previewList"});var i}),t._id)}))),g:e.f(d.value,((t,n,i)=>({a:"114e0122-0-"+i,b:e.p({item:t}),c:t._id,d:e.o((i=>async function(t,n){e.index.vibrateShort&&e.index.vibrateShort(),await e.nr.callFunction({name:"upNewsview_count",data:{id:t}}),d.value[n].view_count++,d.value[n].view_count_display=u(d.value[n].view_count),e.index.navigateTo({url:`/pages/newsDetail/newsDetail?id=${t}`})}(t._id,n)),t._id)})))})}};wx.createPage(i);
