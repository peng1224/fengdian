"use strict";const e=require("../../common/vendor.js"),t=require("../../common/assets.js"),a={__name:"chatList",setup(a){const n=e.ref(""),s=e.ref([]),r=e.ref(!0);e.onLoad((()=>{const t=e.index.getStorageSync("userinfo");if(!t||!t.phoneNumber)return r.value=!1,void e.index.showToast({title:"请先登录",icon:"none"});n.value=t.phoneNumber})),e.onShow((()=>{n.value&&(o(),e.index.$emit("refresh-global-badge"))}));const o=async()=>{if(n.value){r.value=!0;try{const t=await e.nr.callFunction({name:"get-chat-list",data:{userPhoneNumber:n.value}});t.result.success?s.value=t.result.data.map((e=>({...e,unread:e.unreadCount||0}))):console.error("获取会话列表失败:",t.result.msg)}catch(t){console.error("请求会话列表时出错:",t)}finally{r.value=!1}}else r.value=!1},u=e=>`${e.avatar||"/static/images/avatar-placeholder.png"}?_t=${Date.now()}`,i=e=>{if(!e)return"";const t=new Date(e),a=new Date,n=new Date(a.getFullYear(),a.getMonth(),a.getDate()),s=new Date(n.getTime()-864e5);return t.getTime()>n.getTime()?`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`:t.getTime()>s.getTime()?"昨天":`${t.getFullYear()}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getDate().toString().padStart(2,"0")}`};return(a,n)=>e.e({a:r.value},r.value?{b:e.f(3,((e,t,a)=>({a:e})))}:s.value.length>0?{d:e.f(s.value,((t,a,n)=>e.e({a:u(t),b:e.o((e=>(e=>{const t=s.value.findIndex((t=>t.sessionId===e.sessionId));t>-1&&(s.value[t].avatar=null)})(t)),t.sessionId),c:e.t(t.name),d:e.t(i(t.lastTime)),e:e.t(t.lastMessage),f:t.unread>0},t.unread>0?{g:e.t(t.unread>99?"99+":t.unread)}:{},{h:t.sessionId,i:e.o((a=>{return n=t.sessionId,void e.index.navigateTo({url:`/pages/chatDetail/chatDetail?sessionId=${n}`});var n}),t.sessionId)})))}:{e:t._imports_0$1},{c:s.value.length>0})}},n=e._export_sfc(a,[["__scopeId","data-v-47ecee2f"]]);wx.createPage(n);
