"use strict";const e=require("../../common/vendor.js"),a={__name:"EditProfile",setup(a){const o=e.ref(""),n=e.ref(""),t=e.ref(""),i=e.ref("");function r(){e.index.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:e=>{t.value=e.tempFilePaths[0]}})}async function s(){if(!o.value.trim())return e.index.showToast({title:"姓名不能为空",icon:"none"});const a=(e.index.getStorageSync("userinfo")||{}).phoneNumber;if(!a)return e.index.showToast({title:"缺少用户标识符",icon:"none"});e.index.showLoading({title:"保存中..."});try{if(t.value){const a=`User-Avatar/${Date.now()}.jpg`,o=await e.nr.uploadFile({cloudPath:a,filePath:t.value});if(!o.fileID)throw new Error("头像上传失败");i.value=o.fileID}const{result:r}=await e.nr.callFunction({name:"updateUserProfile",data:{phoneNumber:a,name:o.value,avatar:i.value||"",oldAvatarFileID:n.value||""}});if(200!==r.code||!r.success)throw new Error(r.msg||"云函数返回错误");e.index.setStorageSync("userinfo",r.data),e.index.hideLoading(),e.index.showToast({title:"更新成功",icon:"success"}),setTimeout((()=>e.index.navigateBack()),800)}catch(r){console.error("更新过程出错:",r),e.index.hideLoading(),e.index.showToast({title:r.message||"更新失败，请重试",icon:"none"})}}return e.onMounted((()=>{const a=e.index.getStorageSync("userinfo")||{};o.value=a.name||"",n.value=a.avatar||""})),(a,i)=>({a:t.value||n.value,b:e.o(r),c:o.value,d:e.o((e=>o.value=e.detail.value)),e:e.o(s)})}},o=e._export_sfc(a,[["__scopeId","data-v-dd5cda59"]]);wx.createPage(o);
